{% load static %}
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}Michishare{% endblock %}</title>
  

  <!-- モバイル最適化 -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#2563eb">
  <meta name="format-detection" content="telephone=no">
  <!-- ダークモード時に勝手に白文字化されるのを防ぐ（常にライト基調） -->
  <meta name="color-scheme" content="light">
  <link rel="stylesheet" href="{% static 'css/michi.css' %}">
  <!-- 追加の<head>要素（ページ別） -->
  {% block extra_head %}{% endblock %}

  <!-- 共通スタイル -->
  
</head>
<body>

  <!-- ヘッダー / ナビ -->
  <!-- ヘッダー / ナビ -->
<header class="appbar">
  <div class="container nav">
    <a class="brand" href="{% url 'plans:feed' %}">
      <span class="brand-badge">M</span> Michishare
    </a>

    <nav class="nav-links">
      <a class="btn" href="{% url 'plans:feed' %}">ホーム</a>
      <a class="btn primary" href="{% url 'plans:plan_create' %}">新規作成</a>
    
      <!-- 検索フォーム -->
      <form action="{% url 'plans:feed' %}" method="get" style="display:inline-flex; gap:6px; align-items:center">
        <input
          type="search" name="q" value="{{ q|default_if_none:'' }}"
          placeholder="キーワード / #タグ / @ユーザー"
          style="height:34px;padding:0 10px;border:1px solid var(--border);border-radius:8px;min-width:220px"
        />
        <button class="btn" type="submit">検索</button>
      </form>
    
      {% if user.is_authenticated %}
        <!-- プロフィール -->
        <a href="{% url 'accounts:profile' user.username %}"
           class="tap"
           style="display:inline-flex;align-items:center;gap:8px;text-decoration:none;padding:10px 8px">
          <img
            src="{% if user.profile.avatar %}{{ user.profile.avatar.url }}{% else %}{% static 'img/avatar-placeholder.png' %}{% endif %}"
            alt="" style="width:28px;height:28px;border-radius:9999px;object-fit:cover;border:1px solid var(--border)">
          <span class="muted">@{{ user.username }}</span>
        </a>
    
        <!-- ログアウト -->
        <form method="post" action="{% url 'logout' %}" style="display:inline">
          {% csrf_token %}
          <button class="btn ghost" type="submit">ログアウト</button>
        </form>
      {% else %}
        <!-- 新規登録/ログイン -->
        <a class="btn primary" href="{% url 'accounts:signup' %}">新規登録</a>
        <a class="btn ghost" href="{% url 'login' %}">ログイン</a>
      {% endif %}
    </nav>
    
  </div>
</header>


  <!-- 本文 -->
  <main class="container">
    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="msg {% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    {% block content %}{% endblock %}
  </main>

  <footer class="site">
    <div class="container">© {% now "Y" %} Michishare</div>
  </footer>

  <!-- 共通スクリプト（CSRFヘルパ／100vh補正など） -->
  <script>
    // CSRF Cookie ヘルパ（fetchで使う）
    window.getCookie = function(name){
      const v = `; ${document.cookie}`; const p = v.split(`; ${name}=`);
      if (p.length === 2) return p.pop().split(';').shift();
    };

    // iOS の 100vh 問題に実際に適用
    const setDocHeight = () => document.documentElement.style.setProperty('--vh', (window.innerHeight * 0.01) + 'px');
    setDocHeight(); addEventListener('resize', setDocHeight);
    // 使う側: height: calc(var(--vh, 1vh) * 100);
  </script>

  {% block extra_js %}{% endblock %}
</body>
</html>

